.\" Man page generated from reStructuredText.
.
.
.nr rst2man-indent-level 0
.
.de1 rstReportMargin
\\$1 \\n[an-margin]
level \\n[rst2man-indent-level]
level margin: \\n[rst2man-indent\\n[rst2man-indent-level]]
-
\\n[rst2man-indent0]
\\n[rst2man-indent1]
\\n[rst2man-indent2]
..
.de1 INDENT
.\" .rstReportMargin pre:
. RS \\$1
. nr rst2man-indent\\n[rst2man-indent-level] \\n[an-margin]
. nr rst2man-indent-level +1
.\" .rstReportMargin post:
..
.de UNINDENT
. RE
.\" indent \\n[an-margin]
.\" old: \\n[rst2man-indent\\n[rst2man-indent-level]]
.nr rst2man-indent-level -1
.\" new: \\n[rst2man-indent\\n[rst2man-indent-level]]
.in \\n[rst2man-indent\\n[rst2man-indent-level]]u
..
.TH "VDU_CONTROLS" "1" "Mar 14, 2025" "" "vdu_controls"
.SH NAME
vdu_controls \- vdu_controls 2.2.0
.SH VDU_CONTROLS - A DDC CONTROL PANEL FOR MONITORS
.sp
A control panel for DisplayPort, DVI, HDMI, or USB connected VDUs (\fIVisual Display Units\fP).
.SH SYNOPSIS:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B vdu_controls
[\-\-help|\-h] [\-\-about] [\-\-detailed\-help]
[\-\-show {brightness,contrast,audio\-volume,input\-source,power\-mode,osd\-language}]
[\-\-hide {brightness,contrast,audio\-volume,input\-source,power\-mode,osd\-language}]
[\-\-enable\-vcp\-code vcp_code] [\-\-schedule|\-\-no\-schedule]
[\-\-splash|\-\-no\-splash] [\-\-system\-tray|\-\-no\-system\-tray]
[\-\-hide\-on\-focus\-out|\-\-no\-hide\-on\-focus\-out] [\-\-smart\-window|\-\-no\-smart\-window]
[\-\-monochrome\-tray|\-\-no\-monochrome\-tray] [\-\-mono\-light\-tray|\-\-no\-mono\-light\-tray]
[\-\-protect\-nvram|\-\-no\-protect\-nvram]
[\-\-lux\-options|\-\-no\-lux\-options]
[\-\-schedule|\-\-no\-schedule] [\-\-weather|\-\-no\-weather]
[\-\-dbus\-client|\-\-no\-dbus\-client] [\-\-dbus\-events|\-\-no\-dbus\-events]
[\-\-syslog|\-\-no\-syslog] [\-\-debug|\-\-no\-debug] [\-\-warnings|\-\-no\-warnings]
[\-\-translations|\-\-no\-translations]
[\-\-location latitude,longitude]
[\-\-sleep\-multiplier multiplier] [\-\-ddcutil\-extra\-args \(aqextra args\(aq]
[\-\-create\-config\-files] [\-\-install] [\-\-uninstall]
.UNINDENT
.UNINDENT
.UNINDENT
.SS Optional arguments:
.sp
Arguments supplied on the command line override config file equivalent settings.
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B  \-h\fP,\fB  \-\-help
show this help message and exit
.TP
.B  \-\-detailed\-help
full help in Markdown format
.TP
.B  \-\-about
info about vdu_controls
.TP
.BI \-\-show \ control_name
show specified control only, may be specified multiple times
.TP
.BI \-\-hide \ control_name
hide/disable a control, may be specified multiple times
.TP
.BI \-\-enable\-vcp\-code \ vcp_code
enable a control for a vcp\-code unavailable via hide/show,
may be specified multiple times
.UNINDENT
.INDENT 0.0
.TP
.B \-\-splash|\-\-no\-splash
show the splash screen.  \fB\-\-splash\fP is the default.
.TP
.B \-\-system\-tray|\-\-no\-system\-tray
start up as an entry in the system tray.
\fB\-\-no\-system\-tray\fP is the default.
.TP
.B \-\-hide\-on\-focus\-out|\-\-no\-hide\-on\-focus\-out
minimize the main window automatically on focus out
\fB\-\-no\-hide\-on\-focus\-out\fP is the default.
.TP
.B \-\-smart\-window|\-\-no\-smart\-window
smart main window placement and geometry.
\fB\-\-smart\-window\fP is the default (may force UI to XWayland).
.TP
.B \-\-monochrome\-tray|\-\-no\-monochrome\-tray
monochrome dark themed system\-tray.
\fB\-\-no\-monochrome\-tray\fP is the default.
.TP
.B \-\-mono\-light\-tray|\-\-no\-mono\-light\-tray
monochrome themed system\-tray.
\fB\-\-no\-mono\-light\-tray\fP is the default.
.TP
.B \-\-protect\-nvram|\-\-no\-protect\-nvram
alter options and defaults to minimize VDU NVRAM writes
.TP
.B \-\-order\-by\-name|\-\-no\-order\-by\-name
order tabs, lists, and dropdowns by VDU name
.TP
.B \-\-lux\-options|\-\-no\-lux\-options
enable/disable ambient light metering options.
\fB\-\-lux\-options\fP is the default.
.TP
.B \-\-schedule|\-\-no\-schedule
enable/disable preset scheduling. \fB\-\-schedule\fP is the default.
.TP
.B \-\-weather|\-\-no\-weather
enable/disable weather lookups. \fB\-\-weather\fP is the default.
.TP
.B \-\-dbus\-client|\-\-no\-dbus\-client
use the D\-Bus ddcutil\-service instead of the ddcutil command
\fB\-\-dbus\-client\fP is the default
.TP
.B \-\-dbus\-events|\-\-no\-dbus\-events
enable D\-Bus ddcutil\-service client events
\fB\-\-dbus\-events\fP is the default
.TP
.B \-\-syslog|\-no\-syslog
divert diagnostic output to the syslog (journald).
\fB\-\-no\-syslog\fP is the default.
.TP
.B \-\-debug|\-\-no\-debug
enable/disable additional debug information.
\fB\-\-no\-debug\fP is the default.
.UNINDENT
.INDENT 0.0
.TP
.B  \-\-warnings\-\-no\-warnings
popup a warning when a VDU lacks an enabled control.
\fB\-\-no\-warnings\fP is the default.
.UNINDENT
.INDENT 0.0
.TP
.B \-\-translations|\-\-no\-translations
enable/disable language translations.
\fB\-\-no\-translations\fP is the default.
.TP
.B \-\-location latitude,longitude
local latitude and longitude for triggering presets
by solar elevation
.UNINDENT
.INDENT 0.0
.TP
.B  \-\-sleep\-multiplier
set the default ddcutil sleep multiplier
protocol reliability multiplier for ddcutil (typically
0.1 .. 2.0, default is 1.0)
.TP
.B  \-\-ddcutil\-extra\-args
extra arguments to pass to ddcutil (enclosed in single quotes)
.TP
.B  \-\-create\-config\-files
if they do not exist, create template config INI files
in $HOME/.config/vdu_controls/
.TP
.B  \-\-install
installs the vdu_controls in the current user\(aqs path and
desktop application menu.
.TP
.B  \-\-uninstall
uninstalls the vdu_controls application menu file and
script for the current user.
.UNINDENT
.UNINDENT
.UNINDENT
.SH DESCRIPTION
.sp
\fBvdu_controls\fP is a control\-panel for DisplayPort, DVI, HDMI, or USB connected VDUs.  Out of the
box, \fBvdu_controls\fP offers a subset of controls including brightness, contrast and audio
controls.  Additional controls can be enabled via the \fBSettings\fP dialog.
.sp
\fBvdu_controls\fP interacts with VDUs by using \fBddcutil\fP to issue standard VESA
\fIVirtual Control Panel\fP  (\fIVCP\fP) commands via the VESA  \fIDisplay Data Channel\fP (\fIDDC\fP).
\fBDdcutil\fP provides a robust interface that is tolerant of the vagaries of the many OEM DDC
implementations.
.sp
From \fBvdu_controls 2.0\fP onward, \fBvdu_controls\fP defaults to using the \fBD\-Bus ddcutil\-service\fP\&.
Should the \fBddcutil\-service\fP be unavailable, \fBvdu_controls\fP will fall back to running the
\fBddcutil\fP command to perform each request.
.sp
The UI\(aqs look\-and\-feel dynamically adjusts to dark and light themes. The application may
optionally run in the system tray of KDE, Deepin, GNOME, and Xfce (and possibly others).
.sp
The UI provides an optional \fBambient\-light slider\fP for simultaneously adjusting
all VDUs according to custom per\-VDU ambient lux/brightness profiles.  Options are included
for automated adjustment by accessing a hardware light\-meters, webcams, or other devices.
.sp
Named \fBPreset\fP configurations can be saved and recalled. For example, presets may be created
for night, day, photography, movies, and so forth.   Presets can be triggered by specific ambient
light levels, scheduled according to local solar elevation, vetoed by local weather conditions,
or activated by UNIX signals.
.sp
From any UI window, \fIF1\fP accesses help, and \fIF10\fP accesses the main\-menu.   The main\-menu is
also available via the hamburger\-menu, and also via the right\-mouse button in either the
main\-window or the system\-tray icon.  The main\-menu has \fIALT\-key\fP shortcuts for all menu items
(subject to sufficient letters being available to distinguish all user defined presets).
.sp
For further information, including screenshots, see \X'tty: link https://github.com/digitaltrails/vdu_controls'\fI\%https://github.com/digitaltrails/vdu_controls\fP\X'tty: link' .
.sp
The long term affects of repeatably rewriting a VDUs setting are not well understood, but some
concerns have been expressed. See \fBLIMITATIONS\fP for further details.
.SH CONFIGURATION
.sp
Configuration changes can be made via the \fBSettings\fP dialog or by editing the config\-files.
.SS Settings Menu and Config files
.sp
The \fBSettings\fP dialog features a tab for editing common/default settings as well as
tabs specific to each VDU.  The config files are named according to the following scheme:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
Application wide default config: \fB$HOME/.config/vdu_controls/vdu_controls.conf\fP
.IP \(bu 2
VDU model and serial number config: \fB$HOME/.config/vdu_controls/<model>_<serial|display_num>.conf\fP
.IP \(bu 2
VDU model only config: \fB$HOME/.config/vdu_controls/<model>.conf\fP
.UNINDENT
.UNINDENT
.UNINDENT
.sp
The VDU\-specific config files can be used to:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
Correct manufacturer built\-in metadata.
.IP \(bu 2
Customise which controls are to be provided for each VDU.
.IP \(bu 2
Define a user\-friendly label for each VDU.
.IP \(bu 2
Set optimal \fBddcutil\fP DDC parameters for each VDU.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
The config files are in INI\-format divided into a number of sections as outlined below:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
[vdu\-controls\-globals]
# The vdu\-controls\-globals section is only required in $HOME/.config/vdu_controls/vdu_controls.conf
system\-tray\-enabled = yes|no
splash\-screen\-enabled = yes|no
translations\-enabled = yes|no
weather\-enabled = yes|no
schedule\-enabled = yes|no
lux\-options\-enabled = yes|no
warnings\-enabled = yes|no
debug\-enabled = yes|no
syslog\-enabled = yes|no

[vdu\-controls\-widgets]
# Yes/no for each of the control options that vdu_controls normally provides by default.
brightness = yes|no
contrast = yes|no
audio\-volume = yes|no
audio\-mute = yes|no
audio\-treble = yes|no
audio\-bass = yes|no
audio\-mic\-volume = yes|no
input\-source = yes|no
power\-mode = yes|no
osd\-language = yes|no

# Enable ddcutil supported codes not enabled in vdu_controls by default, CSV list of two\-digit hex values.
enable\-vcp\-codes = NN, NN, NN

# User friendly VDU name
vdu_name = My Main Monitor (on the right)

[ddcutil\-parameters]
# Useful values appear to be >=0.1
sleep\-multiplier = 0.5

[ddcutil\-capabilities]
# The (possibly edited) output from \(dqddcutil \-\-display N capabilities\(dq with leading spaces retained.
capabilities\-override =
.EE
.UNINDENT
.UNINDENT
.sp
Config files can only be used to enable and alter definitions of VCP codes supported by \fBddcutil\fP\&.
Unsupported manufacturer specific features should only be experimented with caution, some
may have irreversible consequences, including bricking the hardware.
.sp
As well as using the \fBSettings\fP, config files may also be created by the command line option:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
vdu_controls \-\-create\-config\-files
.EE
.UNINDENT
.UNINDENT
.sp
which will create initial templates based on the currently connected VDUs.
.sp
The config files are completely optional, they need not be used if the default options are found to be
adequate.
.SS Adding value restrictions to a VDU\(aqs capabilities override
.sp
In some cases, a VDU\(aqs DDC reported minimums and maximums may be incorrect or overstated.  Within
vdu_controls this can be corrected by overriding the DDC reported range. For example, perhaps a VDU
reports it supports a brightness range of 0 to 100, but in fact only practically supports 20 to 90.
This can be corrected by bringing up the VDU\(aqs settings tab and editing the text in
the \fBcapabilities override\fP:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP 1. 3
Open the \fISettings\fP tab for the VDU, navigate to the \(dqcapabilities override* field
.IP 2. 3
locate the feature, in this example, the brightness,
.IP 3. 3
add a \fBValues:\fP \fBmin..max\fP specification to line the following the feature definition,
.IP 4. 3
save the changes.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
For the brightness example the completed edit would look like:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
Feature: 10 (Brightness)
    Values: 20..80
.EE
.UNINDENT
.UNINDENT
.sp
The vdu_controls slider for that value will now be restricted to the specified range.
.SS Adding a refresh/reload requirement to a VDU\(aqs capabilities override
.sp
Altering the values of some VCP codes may result in a cascade of changes to other
codes.  For example, changing a VCP value for \fIPicture Mode\fP might result in changes
to several VCP\-code features, including brightness, contrast, and others. Exactly
which codes have these kinds of side effects isn\(aqt indicated in the metadata
obtained from each VDU, however vdu_controls supports adding \fIrefresh\fP annotations
to the feature\-names within the \fBcapabilities override\fP\&.  For example:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
Feature: 15 (Picture Mode)
.EE
.UNINDENT
.UNINDENT
.sp
Can be annotated with:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
Feature: 15 (Picture Mode *refresh*)
.EE
.UNINDENT
.UNINDENT
.sp
With this annotation, when ever \fIPicture Mode\fP is altered, vdu_controls will
reload all configuration files and refresh all control values from the VDUs.
.SS DBUS dccutil\-service
.sp
When available, \fBvdu_controls\fP defaults to interacting with VDUs via the DBUS \fBddcutil\-service\fP
service rather than the \fBddcutil\fP command. The service should be both faster and more
reliable \- noticeably so when multiple VDUs need to be controlled. Whether to use the service
can be controlled by the \fBDBUS client\fP checkbox in the settings dialog.
.sp
When using the service, you may optionally enable service detection of DPMS events and
VDU connectivity events (hot\-plugging cables or power\-cycling VDUs).  Whether to enable events
is controlled by the \fBDBUS events\fP checkbox in the settings dialog.  The reliability
and timeliness of events may vary depending on the model of GPU, version of GPU driver,
model of VDU, and type of VDU connector\-cable.  In some cases the service polling for DPMS or
connection status may wake some VDU models.  Both \fBddcutil\-service\fP or \fBlibddcutil\fP offer
options for finer control over which events are detected and how.
.SS Presets
.sp
A named _Preset_ can be used to save the current VDU settings for later recall. Any number of
presets can be created for different lighting conditions or different applications, for example:
\fINight\fP, \fIDay\fP, \fIOvercast\fP, \fISunny\fP, \fIPhotography\fP, and \fIVideo\fP\&. Each presets can be assigned a
name and icon.
.sp
The \fBPresets\fP item in \fBmain\-menu\fP will bring up a \fBPresets\fP dialog for managing and
applying presets.  The \fBmain\-menu\fP also includes an item for each existing preset.
.sp
Any small SVG or PNG can be assigned as a preset\(aqs icon.  Monochrome SVG icons that conform to the
Plasma color conventions will be automatically inverted if the desktop them is changed from dark to
light. If a preset lacks an icon, an icon will be created from the initials of the first and last
words of its name. A starter set of icons is included in \fB/usr/share/vdu_controls/icons/\fP\&.
.sp
Any time the current VDUs settings match those of a preset, the preset\(aqs name and icon will
automatically show in the window\-title, tray tooltip, tray icon.
.sp
Presets may be set to transition immediately (the default); gradually on schedule (solar elevation);
or gradually always (when triggered by schedule, main\-menu, or UNIX signal).  The speed of
transition is determined by how quickly each VDU can respond to adjustment.  During a transition,
the transition will be abandoned if the controls involved in the transition are altered by any other
activity.
.sp
Each preset is stored in config directory as: \fB$HOME/.config/vdu_controls/Preset_<preset_name>.conf\fP
.sp
Preset files are saved in INI\-file format for ease of editing.  Each preset file contains a
section for each connected VDU, for example:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
[preset]
icon = /usr/share/icons/breeze/status/16/cloudstatus.svg
solar\-elevation = eastern\-sky 40
transition\-type = scheduled
transition\-step\-interval\-seconds = 5

[HP_ZR24w_CNT008]
brightness = 50
osd\-language = 02

[LG_HDR_4K_89765]
brightness = 13
audio\-speaker\-volume = 16
.EE
.UNINDENT
.UNINDENT
.sp
When creating a preset file, you may select which controls to save for each VDU.  For example,
you might create a preset that includes the brightness, but not the contrast or audio\-volume.
Keeping the included controls to a minimum speeds up the transition and reduces the chances of the
VDU failing to keep up with the associated stream of DDC commands.
.sp
While using the GUI to create or edit a preset, activation of scheduled presets and adjustments due
to light\-metering are blocked until editing is complete.
.SS Presets \- VDU initialization\-presets
.sp
For a VDU named \fIabc\fP with a serial number \fIxyz\fP, if a preset named \fIabx xyz\fP exists, that
preset will be restored at startup or when ever the VDU is subsequently detected.
.sp
This feature is designed to restore settings that cannot be saved in the VDU’s NVRAM
or for VDUs where the NVRAM capacity has been exhausted or is faulty.
.SS Presets \- solar elevation triggers
.sp
A preset may be set to automatically trigger when the sun rises to a specified elevation. The idea
being to allow a preset to trigger relative to dawn or dusk, or when the sun rises above some
surrounding terrain (the time of which will vary as the seasons change).
.sp
If a preset has an elevation, the preset will be triggered each day at a time calculated according
to the latitude and longitude specified by in the \fBvdu\-controls\-globals\fP \fBlocation\fP option.
By choosing an appropriate \fBsolar\-elevation\fP a preset may be confined to specific times of the
year.  For example, a preset with a positive solar elevation will not trigger at mid\-winter in the
Arctic circle (because the sun never gets that high).  Any preset may be manually invoked
regardless of its specified solar elevations.
.sp
To assign a trigger, use the Preset Dialog to set a preset\(aqs \fBsolar\-elevation\fP\&.  A solar elevation
may range from \-19 degrees in the eastern sky (morning/ascending) to \-19 degrees in the western sky
(afternoon/descending), with a maximum nearing 90 degrees at midday.
.sp
On any given day, the Preset Dialog may be used to temporarily override any trigger, in which case
the trigger is suspended until the following day.  For example, a user might choose to disable
a trigger intended for the brightest part of the day if the day is particularly dull.
.sp
At startup \fBvdu_controls\fP will restore the most recent preset that would have been triggered for
this day (if any).  For example, say a user has \fBvdu_controls\fP set to run at login, and they\(aqve
also set a preset to trigger at dawn, but they don\(aqt actually log in until just after dawn, the
overdue dawn preset will be triggered at login.
.SS Presets \- Smooth Transitions
.sp
__To minimize writes to VDU NVRAM, smooth\-transitions have been deprecated and are disabled by
default. To reenable smooth transitions, uncheck the \fBprotect\-nvram\fP option in _Settings_.__
.sp
A preset may be set to \fBSmoothly Transition\fP, in which case changes to controls continuous\-value
slider controls such as brightness and contrast will be stepped by one until the final values are
reached.  Any non\-continuous values will be set after all continuous values have reached their
final values, for example, if input\-source is included in a preset, it will be restored at the end.
.sp
The Preset Dialog includes a combo\-box for defining when to apply transitions to a preset:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
\fBNone\fP \- change immediately;
.IP \(bu 2
\fBOn schedule\fP \- slowly change according to a solar elevation trigger;
.IP \(bu 2
\fBOn signal\fP \- slowly change on the appropriate UNIX signal;
.IP \(bu 2
\fBOn menu\fP \- slowly change when selected in the main\-menu;
.UNINDENT
.UNINDENT
.UNINDENT
.sp
Normally a transition single\-steps the controls as quickly as possible.  In practice this means each
step takes one or more seconds and increases linearly depending on the number of VDUs and number of
controls being altered.  The Presets Dialog includes a \fBTransition Step seconds\fP control that can
be used to increase the step interval and extend a transition over a longer period of time.
.sp
If any transitioning controls change independently of the transition, the transition will cease.  In
that manner a transition can be abandoned by dragging a slider or choosing a different preset.
.SS Presets \- supplementary weather requirements
.sp
A solar elevation trigger can have a weather requirement which will be checked against the weather
reported by \X'tty: link https://wttr.in'\fI\%https://wttr.in\fP\X'tty: link'\&.
.sp
By default, there are three possible weather requirements: \fBgood\fP, \fBbad\fP, and \fBall weather\fP\&.
Each  requirement is defined by a file containing a list of WWO (\X'tty: link https://www.worldweatheronline.com'\fI\%https://www.worldweatheronline.com\fP\X'tty: link')
weather codes, one per line.  The three default requirements are contained in the files
\fB$HOME/.config/vdu_controls/{good,bad,all}.weather\fP\&.  Additional weather requirements can be
created by using a text editor to create further files.  The \fBall.weather\fP file exists primarily
as a convenient resource that lists all possible codes.
.sp
Because reported current weather conditions may be inaccurate or out of date, it\(aqs best to use
weather requirements as a coarse measure. Going beyond good and bad may not be very practical.
What\(aqs possible might depend on you local weather conditions.
.sp
To ensure \fBwttr.in\fP supplies the weather for your location, please ensure that \fBSettings\fP
\fBLocation\fP includes a place\-name suffix.  The \fBSettings\fP \fBLocation\fP \fBDetect\fP button has been
enhanced to fill out a place\-name for you.  Should \fBwttr.in\fP not recognise a place\-name, the
place\-name can be manually edited to something more suitable. The nearest big city or an
airport\-code will do, for example: LHR, LAX, JFK.  You can use a web browser to test a place\-name,
for example: \X'tty: link https://wttr.in/JFK'\fI\%https://wttr.in/JFK\fP\X'tty: link'
.sp
When weather requirements are in use, \fBvdu_controls\fP will check that the coordinates in
\fBSettings\fP \fBLocation\fP are a reasonable match for those returned from \fBwttr.in\fP, a warning will
be issued if they are more than 200 km (124 miles) apart.
.sp
If the place\-name is left blank, the \fBwttr.in\fP server will try to guess you location from your
external IP address.  The guess may not be accurate and may vary over time.
.SS Presets \- remote control
.sp
Scripts may use UNIX/Linux signals may be used to instruct a running \fBvdu_controls\fP to invoke a
preset or to initiate \(dqRefresh settings from monitors\(dq.  Signals in the range 40 to 55 correspond to
first to last presets (if any are defined).  Additionally, SIGHUP can be used to initiate \(dqRefresh
settings from monitors\(dq.  For example:
.INDENT 0.0
.INDENT 3.5
Identify the running vdu_controls (assuming it is installed as /usr/bin/vdu_controls):
.INDENT 0.0
.INDENT 3.5
.sp
.EX
ps axwww | grep \(aq[/]usr/bin/vdu_controls\(aq
.EE
.UNINDENT
.UNINDENT
.sp
Combine this with kill to trigger a preset change:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
kill \-40 $(ps axwww | grep \(aq[/]usr/bin/vdu_controls\(aq | awk \(aq{print $1}\(aq)
kill \-41 $(ps axwww | grep \(aq[/]usr/bin/vdu_controls\(aq | awk \(aq{print $1}\(aq)
.EE
.UNINDENT
.UNINDENT
.sp
Or if some other process has changed a VDUs settings, trigger vdu_controls to update its UI:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
kill \-HUP $(ps axwww | grep \(aq[/]usr/bin/vdu_controls\(aq | awk \(aq{print $1}\(aq)
.EE
.UNINDENT
.UNINDENT
.UNINDENT
.UNINDENT
.sp
Any other signals will be handled normally (in many cases they will result in process termination).
.SS Ambient Light Levels and Light/Lux Metering
.sp
The default UI includes an \fBambient\-light slider\fP which will simultaneously adjust all VDUs
according to custom per\-VDU lux/brightness profiles.  As well as indicating the ambient light
level manually via the slider, \fBvdu_controls\fP can be configured to periodically read from a
hardware lux metering device and adjust brightness automatically.  The Lux\-Dialog provides
controls for setting up light metering and VDU lux/brightness profiles.  If ambient light level
controls are not required, the Settings Dialog includes an option to disable and hide them.
.sp
As well as the manual\-slider, a metering device may be a serial\-device, a UNIX FIFO (named\-pipe),
or an executable (script or program):
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
A serial\-device must periodically supply one floating\-point lux\-value
terminated by a carriage\-return newline.
.IP \(bu 2
A FIFO must periodically supply one floating\-point lux\-value terminated by a newline.
.IP \(bu 2
An executable must supply one floating\-point lux\-value reading terminated by a newline each time
it is run.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
Possible hardware devices include:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
An Arduino with a GY\-30/BH1750 lux meter writing to a usb serial\-port.
.IP \(bu 2
A webcam periodically sampled to produce approximate lux values.  Values
might be estimated by analysing image content or image settings that
contribute to exposure, such ISO values, apertures, and shutter speed.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
Further information on various lux metering options, as well as instructions for constructing and
programming an Arduino with a GY\-30/BH1750, can be found at:
.INDENT 0.0
.INDENT 3.5
\X'tty: link https://github.com/digitaltrails/vdu_controls/blob/master/Lux-metering.md'\fI\%https://github.com/digitaltrails/vdu_controls/blob/master/Lux\-metering.md\fP\X'tty: link'
.UNINDENT
.UNINDENT
.sp
Example scripts for mapping a webcam\(aqs average\-brightness to approximate lux values are included in
\fB/usr/share/vdu_controls/sample\-scripts/\fP or they can also be downloaded from the following
location:
.INDENT 0.0
.INDENT 3.5
\X'tty: link https://github.com/digitaltrails/vdu_controls/tree/master/sample-scripts'\fI\%https://github.com/digitaltrails/vdu_controls/tree/master/sample\-scripts\fP\X'tty: link'\&.
.UNINDENT
.UNINDENT
.sp
The examples include \fBvlux_meter.py\fP, a beta\-release Qt\-GUI python\-script that meters from a
webcam and writes to a FIFO (\fI$HOME/.cache/vlux_fifo\fP). Controls are included for mapping
image\-brightness to lux mappings, and for defining a crop from which to sample brightness values.
The script optionally runs in the system\-tray.
.sp
The examples may require customising for your own webcam and lighting conditions.
.SS Lux Metering and brightness transitions
.sp
Due to VDU hardware and DDC protocol limitations, gradual transitions from one brightness level to
another are likely to be noticeable and potentially annoying.  As well as being annoying
excessive stepping may eat into VDU NVRAM lifespan.
.sp
The auto\-brightness adjustment feature includes several measures to reduce the number of
changes passed to the VDU:
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.IP \(bu 2
Lux/Brightness Profiles may be altered for local conditions so that
brightness levels remain constant over set ranges of lux values (night, day, and so forth).
.IP \(bu 2
Adjustments are only made at intervals of one or more minutes (default is 10 minutes).
.IP \(bu 2
The adjustment task passes lux values through a smoothing low\-pass filter.
.IP \(bu 2
A VDU brightness profile may optionally be set to stair\-step with no interpolation
of intermediate values.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
When ambient light conditions are fluctuating, for example, due to passing clouds, automatic adjust
can be manually suspended.  The main\-panel, main\-menu, and light\-metering dialog each contain controls for
toggling Auto/Manual.  Additionally, moving the manual lux\-slider turns off automatic adjustment.
.sp
The Light\-metering dialog includes an option to enable auto\-brightness interpolation. This option
will enable the calculation of values between steps in the profiles. In order to avoid small
fluctuating changes, interpolation won\(aqt result in brightness changes less than 10%.  During
interpolation, if a lux value is found to be in proximity to any attached preset, the preset
values will be preferred over interpolated ones.
.SS Light/Lux Metering and Presets
.sp
The Light\-Metering Dialog includes the ability to set a Preset to trigger at a lux value.  This feature
is accessed by hovering under the bottom axis of the Lux Profile Chart.
.sp
When a preset is tied to a lux value, the preset\(aqs VDU brightness values become fixed points on the
Lux Profile Chart.  When the specified metered lux value is achieved, the stepping process will
restore the preset\(aqs brightness values and then trigger the full restoration of the preset.  This
ordering of events reduces the likelihood of metered\-stepping, and preset\-restoration from clashing.
.sp
A preset that does not include a VDU\(aqs brightness may be attached to a lux point to restore one or
more non\-brightness controls.  For example, on reaching a particular lux level, an attached preset
might restore a contrast setting.
.sp
If a preset is attached to a lux value and then detached, the preset\(aqs profile points will be
converted to normal (editable) profile points. Attach/detach is a quick way to copy VDU brightness
values from presets if you don\(aqt want to permanently attach them.
.sp
If you utilise light\-metered auto\-brightness and preset\-scheduling together, their combined effects
may conflict. For example, a scheduled preset may set a reduced brightness, but soon after,
light\-metering might increase it.  If you wish to use the two together, design your lux/brightness
profile steps to match the brightness levels of specific presets, for example, a full\-sun preset and
the matching step in a lux/brightness Profile might both be assigned the same brightness level.
.SS Lux Metering Internal Parameters
.sp
The following internal constants can be altered by manually editing
\fI~/.config/vdu_controls/AutoLux.conf\fP\&.  They guide the various metering and auto\-adjustment
heuristics:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
[lux\-meter]
# How many times per minute to sample from the Lux meter (for auto\-adjustment)
samples\-per\-minute=3
# How many samples to include in the smoothing process
smoother\-n=5
# How heavily should past values smooth the present value (smaller = more smoothing)
# See: https://en.wikipedia.org/wiki/Low\-pass_filter#Simple_infinite_impulse_response_filter
smoother\-alpha=0.5
# If an interpolated value yields a change in brightness, how big should the change
# be to trigger an actual VDU change in brightness? Also determines how close
# an interpolated value needs to be to an attached preset\(aqs brightness in order
# to prefer triggering the preset over applying the interpolated value.
interpolation\-sensitivity\-percent=10
# Jump brightness in one step up to this maximum, after which transition in steps.
max\-brightness\-jump=100
.EE
.UNINDENT
.UNINDENT
.SS Improving Response Time: Dynamic Optimization and Sleep Multipliers
.sp
If you are using \fBddcutil\fP version 2.0 or greater, \fBvdu_controls\fP will default to using the
\fBddcutil\fP \fIdynamic sleep optimiser\fP\&.  The optimiser automatically tunes and caches VDU specific
timings when ever \fBddcutil\fP is run.  Any reliability\-issues or errors may be automatically
resolved as the optimiser refines it\(aqs cached timings.  Should problems persist, the
optimiser can be disabled by adding \fI\-\-disable\-dynamic\-sleep\fP to the \fBddcutil extra arguments\fP in
the \fBSettings Dialog\fP (either globally on the \fBvdu_controls tab\fP or selectively under each VDU\(aqs
tab).  If dynamic sleep is disabled, multipliers can then be manually assigned. The optimiser\(aqs
heuristics continue to be refined, it may be that some issues may be resolved by moving to a more
recent version of \fBlibddcutil/ddcutil\fP\&.
.sp
For versions of \fBddcutil\fP prior to 2.0, you can manually set the \fBvdu_control\fP
\fBsleep\-multiplier\fP passed to \fBddcutil\fP\&.  A sleep multiplier less than one will speed up the i2c
protocol interactions at the risk of increased protocol errors. The default sleep multiplier of 1.0
has to be quite conservative, many VDUs can cope with smaller multipliers. A bit of experimentation
with multiplier values may greatly speed up responsiveness. In a multi\-VDU setup individual sleep
multipliers can be configured (see previous section).
.SS Improving Response Time and Reliability: Connections and Controls
.sp
\fBDDC/I2C\fP is not a totally reliable form of communication. VDUs may vary in their responsiveness
and compliance.  GPUs, GPU drivers, and types of connection may affect the reliability. Both ddcutil
and vdu_controls attempt to manage the reliability by using repetition and by adjusting timings.
.sp
If you have the choice, a \fBDisplayPort\fP to \fBDisplayPort\fP connection may be more reliable than
\fBDVI\fP or \fBHDMI\fP\&.
.sp
Reducing the number of enabled controls can speed up initialization, decrease the refresh time, and
reduce the time taken to restore presets.
.sp
There\(aqs plenty of useful info for getting the best out of \fBddcutil\fP at \X'tty: link https://www.ddcutil.com/'\fI\%https://www.ddcutil.com/\fP\X'tty: link'\&.
.SH LIMITATIONS
.sp
Repeatably altering VDU settings might affect VDU lifespan, exhausting the NVRAM write
cycles, stressing the VDU power\-supply, or increasing panel burn\-in.
.sp
That said, \fBvdu_controls\fP does include a number of features that can be used
to reduce the overall frequency of adjustments to acceptable levels.
.INDENT 0.0
.IP \(bu 2
Inbuilt mitigations:
+ Slider and spin\-box controls only update the VDU when adjustments become slow or stop (when
.INDENT 2.0
.INDENT 3.5
no change occurs in 0.5 seconds).
.UNINDENT
.UNINDENT
.INDENT 2.0
.IP \(bu 2
Preset restoration only updates the VDU values that differ from its current values.
.IP \(bu 2
Transitioning smoothly has been disabled by default and deprecated for version 2.1.0 onward.
.IP \(bu 2
Automatic ambient brightness adjustment only triggers a change when the proposed brightness
differs from the current brightness by at least 10%.
.UNINDENT
.IP \(bu 2
Electable mitigations:
+ Choose to restore pre\-prepared \(aqpresets\(aq instead of dragging sliders.
+ Refrain from adding transitions to \fIpresets\fP\&.
+ If using the ambient\-light brightness response curves, tune the settings and
.INDENT 2.0
.INDENT 3.5
curves to minimize frequent small changes.
.UNINDENT
.UNINDENT
.INDENT 2.0
.IP \(bu 2
If using a light\-meter, disengage metered automatic adjustment when faced with
rapidly fluctuating levels of ambient brightness.
.IP \(bu 2
Consider adjusting the ambient lighting instead of the VDU.
.UNINDENT
.IP \(bu 2
Monitoring to assist with making adjustments:
+ Hovering over a VDU name in the main window reveals a popup that includes
.INDENT 2.0
.INDENT 3.5
the number of VCP (NVRAM) writes.
.UNINDENT
.UNINDENT
.INDENT 2.0
.IP \(bu 2
The bottom of the About\-dialog shows the same numbers. They update dynamically.
.UNINDENT
.UNINDENT
.SS Laptops
.sp
Builtin laptop displays normally don\(aqt implement DDC and those displays are not supported, but a
laptop\(aqs externally connected VDUs are likely to be controllable.
.SS Cross\-platform differences
.sp
Wayland doesn\(aqt allow an application to precisely position its windows.  When the \fBsmart\-window\fP
option is enabled, the application switches it\(aqs underlying platform to XWayland so that the
main window position can be saved and restored.
.sp
The UI attempts to step around minor differences between KDE, GNOME, and the rest, the UI on
each may not be exactly the same.
.SS Other concerns
.sp
The power\-supplies in some older VDUs may buzz/squeel audibly when the brightness is
turned way down. This may not be a major issue because, in normal surroundings,
older VDUs are often not usable below about 85\-90% brightness.
.sp
Going beyond the standard DDC features by attempting to experiment with hidden
or undocumented features or values has the potential to make irreversible changes.
.sp
Some controls change the number of connected devices (for example, some VDUs support a power\-off
command). If such controls are used, \fBvdu_controls\fP will detect the change and will reconfigure
the controls for the new situation (for example, DDC VDU 2 may now be DDC VDU 1).  If you change
settings independently of \fBvdu_controls\fP, for example, by using a VDU\(aqs physical controls,  the
\fBvdu_controls\fP UI includes a refresh button to force it to assess the new configuration.
.sp
Some VDU settings may disable or enable other settings in the VDU. For example, setting a VDU to a
specific picture\-profile might result in the contrast\-control being disabled, but \fBvdu_controls\fP
will not be aware of the restriction resulting in its contrast\-control erring or appearing to do
nothing.
.sp
If your VDUs support \fIpicture\-modes\fP, altering any controls in vdu_controls will most likely
result in the picture\-mode being customised.  For example, say you have selected the
VDU\(aqs \fIVivid\fP picture\-mode, if you use vdu_controls to change the brightness, it\(aqs likely
that this will now become the brightness for \fIVivid\fP until the VDU is reset to its defaults.
To avoid confusion, it may be advisable to stick to one picture\-mode for use with vdu_controls,
preserving the others unaltered.
.SH EXAMPLES
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B vdu_controls
All default controls.
.TP
.B vdu_controls \-\-show brightness \-\-show contrast
Specified controls only:
.TP
.B vdu_controls \-\-hide contrast \-\-hide audio\-volume
All default controls except for those to be hidden.
.TP
.B vdu_controls \-\-system\-tray \-\-no\-splash \-\-show brightness \-\-show audio\-volume
Start as a system tray entry without showing the splash\-screen.
.TP
.B vdu_controls \-\-create\-config\-files \-\-system\-tray \-\-no\-splash \-\-show brightness \-\-show audio\-volume
Create template config files in $HOME/.config/vdu_controls/ that include the other settings.
.TP
.B vdu_controls \-\-enable\-vcp\-code 63 \-\-enable\-vcp\-code 93 \-\-warnings \-\-debug
All default controls, plus controls for VCP_CODE 63 and 93, show any warnings, output debugging info.
.UNINDENT
.UNINDENT
.UNINDENT
.sp
This script often refers to displays and monitors as VDUs in order to disambiguate the noun/verb
duality of \(dqdisplay\(dq and \(dqmonitor\(dq
.SH PREREQUISITES
.sp
Described for OpenSUSE, similar for other distros:
.sp
Software:
.INDENT 0.0
.INDENT 3.5
.sp
.EX
zypper install python3 python3\-qt5 noto\-sans\-math\-fonts noto\-sans\-symbols2\-fonts
zypper install ddcutil
zypper install libddcutil ddcutil\-service  # optional, but recommended if available
.EE
.UNINDENT
.UNINDENT
.sp
If you wish to use a serial\-port lux metering device, the \fBpyserial\fP module is a runtime requirement.
.sp
Get ddcutil working first. Check that the detect command detects your VDUs without issuing any
errors:
.INDENT 0.0
.INDENT 3.5
ddcutil detect
.UNINDENT
.UNINDENT
.sp
Read ddcutil documentation concerning config of i2c_dev with nvidia GPUs. Detailed ddcutil info
at \X'tty: link https://www.ddcutil.com/'\fI\%https://www.ddcutil.com/\fP\X'tty: link'
.SH ENVIRONMENT
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B LC_ALL, LANG, LANGUAGE
These  variables specify the locale for language translations and units of distance.
LC_ALL is used by python, LANGUAGE is used by Qt. Normally, they should all have the same
value, for example: \fBDa_DK\fP\&. For these to have any effect on language, \fBSettings\fP
\fBTranslations Enabled\fP must also be enabled.
.TP
.B VDU_CONTROLS_UI_IDLE_SECS
The length of pause in slider or spin\-box control motion that triggers commit of
the controls value to the VDU.  This is a precautionary throttle in case frequently
updating a VDU might shorten its lifespan.  The default is 0.5 seconds.
.TP
.B VDU_CONTROLS_IPINFO_URL
Override the default ip\-address to location service URL (\fBhttps://ipinfo.io/json\fP).
.TP
.B VDU_CONTROLS_WTTR_URL
Override the default weather service URL (\fBhttps://wttr.in\fP).
.TP
.B VDU_CONTROLS_WEATHER_KM
Override the default maximum permissible spherical distance (in kilometres)
between the \fBSettings\fP \fBLocation\fP and \fBwttr.in\fP reported location (\fB200 km\fP, 124 miles).
.TP
.B VDU_CONTROLS_DDCUTIL_ARGS
Add to the list of arguments passed to each exec of ddcutil.
.TP
.B VDU_CONTROLS_DDCUTIL_RETRIES
Set the number of times to repeat a ddcutil getvcp or setvcp before returning an error.
.TP
.B VDU_CONTROLS_DEVELOPER
Changes some search paths to be more convenient in a development
scenario. (\fBno\fP or yes)
.TP
.B VDU_CONTROLS_DBUS_TIMEOUT_MILLIS
Dbus call wait timeout. Default is 10000, 10 seconds.
.UNINDENT
.UNINDENT
.UNINDENT
.SH FILES
.INDENT 0.0
.INDENT 3.5
.INDENT 0.0
.TP
.B $HOME/.config/vdu_controls/
Location for config files, Presets, and other persistent data.
.TP
.B $HOME/.config/vdu_controls/tray_icon.svg
If present, this file is the preferred source for the system\-tray icon. It can be used if the normal
icon conflicts with the desktop theme. If the \fBSettings\fP \fBmonochrome\-tray\fP
and \fBmono\-light\-tray\fP are enabled, they are applied to the file when it is read.
.TP
.B $HOME/.config/vdu_controls/translations/
Location for user supplied translations.
.TP
.B $HOME/.config/vdu_controls.qt.state/
Location for Qt/desktop state such as the past window sizes and locations.
.TP
.B /usr/share/vdu_controls
Location for system\-wide icons,  sample\-scripts, and  translations.
.UNINDENT
.UNINDENT
.UNINDENT
.SH REPORTING BUGS
.sp
\X'tty: link https://github.com/digitaltrails/vdu_controls/issues'\fI\%https://github.com/digitaltrails/vdu_controls/issues\fP\X'tty: link'
.SH GNU LICENSE
.sp
This program is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation, version 3.
.sp
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
more details.
.sp
You should have received a copy of the GNU General Public License along
with this program. If not, see \X'tty: link https://www.gnu.org/licenses/'\fI\%https://www.gnu.org/licenses/\fP\X'tty: link'\&.
.SH AUTHOR
Michael Hamilton
.SH COPYRIGHT
2021, Michael Hamilton
.\" Generated by docutils manpage writer.
.
