<h1 id="vdu_controls---a-ddc-control-panel-for-monitors">vdu_controls -
a DDC control panel for monitors</h1>
<p>A control panel for DisplayPort, DVI, HDMI, or USB connected VDUs
(<em>Visual Display Units</em>).</p>
<h1 id="synopsis">Synopsis:</h1>
<pre><code>    vdu_controls
                 [--help|-h] [--about] [--detailed-help]
                 [--show {brightness,contrast,audio-volume,input-source,power-mode,osd-language}]
                 [--hide {brightness,contrast,audio-volume,input-source,power-mode,osd-language}]
                 [--enable-vcp-code vcp_code] [--schedule|--no-schedule]
                 [--location latitude,longitude] [--weather|--no-weather]
                 [--lux-options|--no-lux-options] [--translations|--no-translations]
                 [--splash|--no-splash] [--system-tray|--no-system-tray]
                 [--monochrome-tray|--no-monochrome-tray] [--mono-light-tray|--no-mono-light-tray]
                 [--hide-on-focus-out|--no-hide-on-focus-out] [--smart-window|--no-smart-window]
                 [--syslog|--no-syslog]  [--debug|--no-debug] [--warnings|--no-warnings]
                 [--sleep-multiplier multiplier] [--ddcutil-extra-args &#39;extra args&#39;]
                 [--dbus-client|--no-dbus-client]
                 [--dbus-signals|--no-dbus-signals]
                 [--create-config-files] [--install] [--uninstall]</code></pre>
<h2 id="optional-arguments">Optional arguments:</h2>
<p>Arguments supplied on the command line override config file
equivalent settings.</p>
<pre><code>  -h, --help            show this help message and exit
  --detailed-help       full help in Markdown format
  --about               info about vdu_controls
  --show control_name
                        show specified control only, may be specified multiple times
  --hide control_name
                        hide/disable a control, may be specified multiple times
  --enable-vcp-code vcp_code
                        enable a control for a vcp-code unavailable via hide/show,
                        may be specified multiple times
  --system-tray|--no-system-tray
                        start up as an entry in the system tray.
                        ``--no-system-tray`` is the default.
  --location latitude,longitude
                        local latitude and longitude for triggering presets
                        by solar elevation
  --translations|--no-translations
                        enable/disable language translations.
                        ``--no-translations`` is the default.
  --schedule|--no-schedule
                        enable/disable preset scheduling. ``--schedule`` is the default.
  --weather|--no-weather
                        enable/disable weather lookups. ``--weather`` is the default.
  --lux-options|--no-lux-options
                        enable/disable ambient light metering options.
                        ``--lux-options`` is the default.
  --debug|--no-debug
                        enable/disable additional debug information.
                        ``--no-debug`` is the default.
  --warnings--no-warnings
                        popup a warning when a VDU lacks an enabled control.
                        ``--no-warnings`` is the default.
  --syslog|-no-syslog
                        divert diagnostic output to the syslog (journald).
                        ``--no-syslog`` is the default.
  --hide-on-focus-out|--no-hide-on-focus-out
                        minimise the main window automatically on focus out
                        ``--no-hide-on-focus-out`` is the default.
  --splash|--no-splash
                        show the splash screen.  ``--splash`` is the default.
  --monochrome-tray|--no-monochrome-tray
                        monochrome dark themed system-tray.
                        ``--no-monochrome-tray`` is the default.
  --mono-light-tray|--no-mono-light-tray
                        monochrome themed system-tray.
                        ``--no-mono-light-tray`` is the default.
  --smart-window|--no-smart-window
                        smart main window placement and geometry.
                        ``--smart-window`` is the default.
  --sleep-multiplier    set the default ddcutil sleep multiplier
                        protocol reliability multiplier for ddcutil (typically
                        0.1 .. 2.0, default is 1.0)
  --ddcutil-extra-args  extra arguments to pass to ddcutil (enclosed in single quotes)
  --dbus-client|--no-dbus-client
                        use the D-Bus ddcutil-service instead of the ddcutil command
                        ``--dbus-client`` is the default
  --dbus-signals|--no-dbus-signals
                        enable D-Bus ddcutil-service VDU-connectivity-change signals
                        ``--dbus-signals`` is the default
  --create-config-files
                        if they do not exist, create template config INI files
                        in $HOME/.config/vdu_controls/
  --install             installs the vdu_controls in the current user&#39;s path and
                        desktop application menu.
  --uninstall           uninstalls the vdu_controls application menu file and
                        script for the current user.</code></pre>
<h1 id="description">Description</h1>
<p><code>vdu_controls</code> is a control-panel for DisplayPort, DVI,
HDMI, or USB connected VDUs. Out of the box, <code>vdu_controls</code>
offers a subset of controls including brightness, contrast and audio
controls. Additional controls can be enabled via the
<code>Settings</code> dialog.</p>
<p><code>vdu_controls</code> interacts with VDUs by using
<code>ddcutil</code> to issue standard VESA <em>Virtual Control
Panel</em> (<em>VCP</em>) commands via the VESA <em>Display Data
Channel</em> (<em>DDC</em>). <code>Ddcutil</code> provides a robust
interface that is tolerant of the vagaries of the many OEM DDC
implementations.</p>
<p>From <code>vdu_controls 2.0</code> onward, <code>vdu_controls</code>
defaults to using the <code>D-Bus ddcutil-service</code>. Should the
<code>ddcutil-service</code> be unavailable, <code>vdu_controls</code>
will fall back to running the <code>ddcutil</code> command to perform
each request.</p>
<p>The UI’s look-and-feel adjusts itself for dark and light desktop
themes. The application may optionally run in the system tray of KDE,
Deepin, GNOME, and Xfce (and possibly others).</p>
<p>The UI provides an optional <code>ambient-light slider</code> for
simultaneously adjusting all VDUs according to custom per-VDU ambient
lux/brightness profiles. Options are included for automated adjustment
by accessing a hardware light-meters, webcams, or other devices.</p>
<p>Named <code>Preset</code> configurations can be saved and recalled.
For example, presets may be created for night, day, photography, movies,
and so forth. Presets can be triggered by specific ambient light levels,
scheduled according to local solar elevation, vetoed by local weather
conditions, or activated by UNIX signals.</p>
<p>From any UI window, <code>F1</code> accesses help, and
<code>F10</code> accesses the main-menu. The main-menu is also available
via the hamburger-menu, and also via the right-mouse button in either
the main-window or the system-tray icon. The main-menu has
<code>ALT-key</code> shortcuts for all menu items (subject to sufficient
letters being available to distinguish all user defined presets).</p>
<p>For further information, including screenshots, see
https://github.com/digitaltrails/vdu_controls .</p>
<p>The long term affects of repeatably rewriting a VDUs setting are not
well understood, but some concerns have been expressed. See
<strong>LIMITATIONS</strong> for further details.</p>
<h1 id="configuration">Configuration</h1>
<p>Configuration changes can be made via the <code>Settings</code>
dialog or by editing the config-files.</p>
<h2 id="settings-menu-and-config-files">Settings Menu and Config
files</h2>
<p>The <code>Settings</code> dialog features a tab for editing
common/default settings as well as tabs specific to each VDU. The config
files are named according to the following scheme:</p>
<ul>
<li>Application wide default config:
<code>$HOME/.config/vdu_controls/vdu_controls.conf</code></li>
<li>VDU model and serial number config:
<code>$HOME/.config/vdu_controls/&lt;model&gt;_&lt;serial|display_num&gt;.conf</code></li>
<li>VDU model only config:
<code>$HOME/.config/vdu_controls/&lt;model&gt;.conf</code></li>
</ul>
<p>The VDU-specific config files can be used to:</p>
<ul>
<li>Correct manufacturer built-in metadata.</li>
<li>Customise which controls are to be provided for each VDU.</li>
<li>Set optimal <code>ddcutil</code> DDC parameters for each VDU.</li>
</ul>
<p>The config files are in INI-format divided into a number of sections
as outlined below::</p>
<pre><code>[vdu-controls-globals]
# The vdu-controls-globals section is only required in $HOME/.config/vdu_controls/vdu_controls.conf
system-tray-enabled = yes|no
splash-screen-enabled = yes|no
translations-enabled = yes|no
weather-enabled = yes|no
schedule-enabled = yes|no
lux-options-enabled = yes|no
warnings-enabled = yes|no
debug-enabled = yes|no
syslog-enabled = yes|no

[vdu-controls-widgets]
# Yes/no for each of the control options that vdu_controls normally provides by default.
brightness = yes|no
contrast = yes|no
audio-volume = yes|no
audio-mute = yes|no
audio-treble = yes|no
audio-bass = yes|no
audio-mic-volume = yes|no
input-source = yes|no
power-mode = yes|no
osd-language = yes|no

# Enable ddcutil supported codes not enabled in vdu_controls by default, CSV list of two-digit hex values.
enable-vcp-codes = NN, NN, NN

[ddcutil-parameters]
# Useful values appear to be &gt;=0.1
sleep-multiplier = 0.5

[ddcutil-capabilities]
# The (possibly edited) output from &quot;ddcutil --display N capabilities&quot; with leading spaces retained.
capabilities-override =</code></pre>
<p>Config files can only be used to enable and alter definitions of VCP
codes supported by <code>ddcutil</code>. Unsupported manufacturer
specific features should only be experimented with caution, some may
have irreversible consequences, including bricking the hardware.</p>
<p>As well as using the <code>Settings</code>, config files may also be
created by the command line option::</p>
<pre><code>vdu_controls --create-config-files</code></pre>
<p>which will create initial templates based on the currently connected
VDUs.</p>
<p>The config files are completely optional, they need not be used if
the default options are found to be adequate.</p>
<h2
id="adding-value-restrictions-to-a-vdus-capabilities-override">Adding
value restrictions to a VDU’s capabilities override</h2>
<p>In some cases, a VDU’s DDC reported minimums and maximums may be
incorrect or overstated. Within vdu_controls this can be corrected by
overriding the DDC reported range. For example, perhaps a VDU reports it
supports a brightness range of 0 to 100, but in fact only practically
supports 20 to 90. This can be corrected by bringing up the VDU’s
settings tab and editing the text in the <strong>capabilities
override</strong>:</p>
<ol type="1">
<li>Open the <em>Settings</em> tab for the VDU, navigate to the
“capabilities override* field</li>
<li>locate the feature, in this example, the brightness,</li>
<li>add a <strong>Values:</strong> <strong>min..max</strong>
specification to line the following the feature definition,</li>
<li>save the changes.</li>
</ol>
<p>For the brightness example the completed edit would look like::</p>
<pre><code>Feature: 10 (Brightness)
    Values: 20..80</code></pre>
<p>The vdu_controls slider for that value will now be restricted to the
specified range.</p>
<h2
id="adding-a-refreshreload-requirement-to-a-vdus-capabilities-override">Adding
a refresh/reload requirement to a VDU’s capabilities override</h2>
<p>Altering the values of some VCP codes may result in a cascade of
changes to other codes. For example, changing a VCP value for
<em>Picture Mode</em> might result in changes to several VCP-code
features, including brightness, contrast, and others. Exactly which
codes have these kinds of side effects isn’t indicated in the metadata
obtained from each VDU, however vdu_controls supports adding
<em>refresh</em> annotations to the feature-names within the
<strong>capabilities override</strong>. For example::</p>
<pre><code>Feature: 15 (Picture Mode)</code></pre>
<p>Can be annotated with::</p>
<pre><code>Feature: 15 (Picture Mode *refresh*)</code></pre>
<p>With this annotation, when ever <em>Picture Mode</em> is altered,
vdu_controls will reload all configuration files and refresh all control
values from the VDUs.</p>
<h2 id="presets">Presets</h2>
<p>A custom named preset can be used to save the current VDU settings
for later recall. Any number of presets can be created for different
lighting conditions or different applications, for example:
<em>Night</em>, <em>Day</em>, <em>Overcast</em>, <em>Sunny</em>,
<em>Photography</em>, and <em>Video</em>. Each presets can be assigned a
name and icon.</p>
<p>The <code>Presets</code> item in <code>main-menu</code> will bring up
a <code>Presets</code> dialog for managing and applying presets. The
<code>main-menu</code> also includes a shortcut for applying each
existing presets.</p>
<p>Any small SVG or PNG can be assigned as a preset’s icon. Monochrome
SVG icons that conform to the Plasma color conventions will be
automatically inverted if the desktop them is changed from dark to
light. If a preset lacks an icon, an icon will be created from its
initials (of its first and last words). A starter set of icons is
included in <code>/usr/share/vdu_controls/icons/</code>.</p>
<p>Any time the current VDUs settings match those of a preset, the
preset’s name and icon will automatically show in the window-title, tray
tooltip, tray icon.</p>
<p>Presets may be set to transition immediately (the default); gradually
on schedule (solar elevation); or gradually always (when triggered by
schedule, main-menu, or UNIX signal). The speed of transition is
determined by how quickly each VDU can respond to adjustment. During a
transition, the transition will be abandoned if the controls involved in
the transition are altered by any other activity.</p>
<p>Each preset is stored in config directory as:
<code>$HOME/.config/vdu_controls/Preset_&lt;preset_name&gt;.conf</code></p>
<p>Preset files are saved in INI-file format for ease of editing. Each
preset file contains a section for each connected VDU, for example::</p>
<pre><code>[preset]
icon = /usr/share/icons/breeze/status/16/cloudstatus.svg
solar-elevation = eastern-sky 40
transition-type = scheduled
transition-step-interval-seconds = 5

[HP_ZR24w_CNT008]
brightness = 50
osd-language = 02

[LG_HDR_4K_89765]
brightness = 13
audio-speaker-volume = 16</code></pre>
<p>When creating a preset file, you may select which controls to save
for each VDU. For example, you might create a preset that includes the
brightness, but not the contrast or audio-volume. Keeping the included
controls to a minimum speeds up the transition and reduces the chances
of the VDU failing to keep up with the associated stream of DDC
commands.</p>
<p>While using the GUI to create or edit a preset, activation of
scheduled presets and adjustments due to light-metering are blocked
until editing is complete.</p>
<h2 id="presets---solar-elevation-triggers">Presets - solar elevation
triggers</h2>
<p>A preset may be set to automatically trigger when the sun rises to a
specified elevation. The idea being to allow a preset to trigger
relative to dawn or dusk, or when the sun rises above some surrounding
terrain (the time of which will vary as the seasons change).</p>
<p>If a preset has an elevation, the preset will be triggered each day
at a time calculated according to the latitude and longitude specified
by in the <code>vdu-controls-globals</code> <code>location</code>
option. By choosing an appropriate <code>solar-elevation</code> a preset
may be confined to specific times of the year. For example, a preset
with a positive solar elevation will not trigger at mid-winter in the
Arctic circle (because the sun never gets that high). Any preset may be
manually invoked regardless of its specified solar elevations.</p>
<p>To assign a trigger, use the Preset Dialog to set a preset’s
<code>solar-elevation</code>. A solar elevation may range from -19
degrees in the eastern sky (morning/ascending) to -19 degrees in the
western sky (afternoon/descending), with a maximum nearing 90 degrees at
midday.</p>
<p>On any given day, the Preset Dialog may be used to temporarily
override any trigger, in which case the trigger is suspended until the
following day. For example, a user might choose to disable a trigger
intended for the brightest part of the day if the day is particularly
dull.</p>
<p>At startup <code>vdu_controls</code> will restore the most recent
preset that would have been triggered for this day (if any). For
example, say a user has <code>vdu_controls</code> set to run at login,
and they’ve also set a preset to trigger at dawn, but they don’t
actually log in until just after dawn, the overdue dawn preset will be
triggered at login.</p>
<h2 id="presets---smooth-transitions">Presets - Smooth Transitions</h2>
<p>A preset may be set to <code>Transition Smoothly</code>, in which
case changes to controls continuous-value slider controls such as
brightness and contrast will be stepped by one until the final values
are reached. Any non-continuous values will be set after all continuous
values have reached their final values, for example, if input-source is
included in a preset, it will be restored at the end.</p>
<p>The Preset Dialog includes a combo-box for defining when to apply
transitions to a preset:</p>
<ul>
<li><code>None</code> - change immediately;</li>
<li><code>On schedule</code> - slowly change according to a solar
elevation trigger;</li>
<li><code>On signal</code> - slowly change on the appropriate UNIX
signal;</li>
<li><code>On menu</code> - slowly change when selected in the
main-menu;</li>
</ul>
<p>Normally a transition single-steps the controls as quickly as
possible. In practice this means each step takes one or more seconds and
increases linearly depending on the number of VDUs and number of
controls being altered. The Presets Dialog includes a
<code>Transition Step seconds</code> control that can be used to
increase the step interval and extend a transition over a longer period
of time.</p>
<p>If any transitioning controls change independently of the transition,
the transition will cease. In that manner a transition can be abandoned
by dragging a slider or choosing a different preset.</p>
<h2 id="presets---supplementary-weather-requirements">Presets -
supplementary weather requirements</h2>
<p>A solar elevation trigger can have a weather requirement which will
be checked against the weather reported by https://wttr.in.</p>
<p>By default, there are three possible weather requirements:
<code>good</code>, <code>bad</code>, and <code>all weather</code>. Each
requirement is defined by a file containing a list of WWO
(https://www.worldweatheronline.com) weather codes, one per line. The
three default requirements are contained in the files
<code>$HOME/.config/vdu_controls/{good,bad,all}.weather</code>.
Additional weather requirements can be created by using a text editor to
create further files. The <code>all.weather</code> file exists primarily
as a convenient resource that lists all possible codes.</p>
<p>Because reported current weather conditions may be inaccurate or out
of date, it’s best to use weather requirements as a coarse measure.
Going beyond good and bad may not be very practical. What’s possible
might depend on you local weather conditions.</p>
<p>To ensure <code>wttr.in</code> supplies the weather for your
location, please ensure that <code>Settings</code> <code>Location</code>
includes a place-name suffix. The <code>Settings</code>
<code>Location</code> <code>Detect</code> button has been enhanced to
fill out a place-name for you. Should <code>wttr.in</code> not recognise
a place-name, the place-name can be manually edited to something more
suitable. The nearest big city or an airport-code will do, for example:
LHR, LAX, JFK. You can use a web browser to test a place-name, for
example: https://wttr.in/JFK</p>
<p>When weather requirements are in use, <code>vdu_controls</code> will
check that the coordinates in <code>Settings</code>
<code>Location</code> are a reasonable match for those returned from
<code>wttr.in</code>, a warning will be issued if they are more than 200
km (124 miles) apart.</p>
<p>If the place-name is left blank, the <code>wttr.in</code> server will
try to guess you location from your external IP address. The guess may
not be accurate and may vary over time.</p>
<h2 id="presets---remote-control">Presets - remote control</h2>
<p>Scripts may use UNIX/Linux signals may be used to instruct a running
<code>vdu_controls</code> to invoke a preset or to initiate “Refresh
settings from monitors”. Signals in the range 40 to 55 correspond to
first to last presets (if any are defined). Additionally, SIGHUP can be
used to initiate “Refresh settings from monitors”. For example:</p>
<pre><code>Identify the running vdu_controls (assuming it is installed as /usr/bin/vdu_controls)::

    ps axwww | grep &#39;[/]usr/bin/vdu_controls&#39;

Combine this with kill to trigger a preset change::

    kill -40 $(ps axwww | grep &#39;[/]usr/bin/vdu_controls&#39; | awk &#39;{print $1}&#39;)
    kill -41 $(ps axwww | grep &#39;[/]usr/bin/vdu_controls&#39; | awk &#39;{print $1}&#39;)

Or if some other process has changed a VDUs settings, trigger vdu_controls to update its UI::

    kill -HUP $(ps axwww | grep &#39;[/]usr/bin/vdu_controls&#39; | awk &#39;{print $1}&#39;)</code></pre>
<p>Any other signals will be handled normally (in many cases they will
result in process termination).</p>
<h2 id="ambient-light-levels-and-lightlux-metering">Ambient Light Levels
and Light/Lux Metering</h2>
<p>The default UI includes an <code>ambient-light slider</code> which
will simultaneously adjust all VDUs according to custom per-VDU
lux/brightness profiles. As well as indicating the ambient light level
manually via the slider, <code>vdu_controls</code> can be configured to
periodically read from a hardware lux metering device and adjust
brightness automatically. The Lux-Dialog provides controls for setting
up light metering and VDU lux/brightness profiles. If ambient light
level controls are not required, the Settings Dialog includes an option
to disable and hide them.</p>
<p>As well as the manual-slider, a metering device may be a
serial-device, a UNIX FIFO (named-pipe), or an executable (script or
program):</p>
<ul>
<li>A serial-device must periodically supply one floating-point
lux-value terminated by a carriage-return newline.</li>
<li>A FIFO must periodically supply one floating-point lux-value
terminated by a newline.</li>
<li>An executable must supply one floating-point lux-value reading
terminated by a newline each time it is run.</li>
</ul>
<p>Possible hardware devices include:</p>
<ul>
<li>An Arduino with a GY-30/BH1750 lux meter writing to a usb
serial-port.</li>
<li>A webcam periodically sampled to produce approximate lux values.
Values might be estimated by analysing image content or image settings
that contribute to exposure, such ISO values, apertures, and shutter
speed.</li>
</ul>
<p>Further information on various lux metering options, as well as
instructions for constructing and programming an Arduino with a
GY-30/BH1750, can be found at:</p>
<pre><code>https://github.com/digitaltrails/vdu_controls/blob/master/Lux-metering.md</code></pre>
<p>Example scripts for mapping a webcam’s average-brightness to
approximate lux values are included in
<code>/usr/share/vdu_controls/sample-scripts/</code> or they can also be
downloaded from the following location:</p>
<pre><code>https://github.com/digitaltrails/vdu_controls/tree/master/sample-scripts.</code></pre>
<p>The examples include <code>vlux_meter.py</code>, a beta-release
Qt-GUI python-script that meters from a webcam and writes to a FIFO
(<code>$HOME/.cache/vlux_fifo</code>). Controls are included for mapping
image-brightness to lux mappings, and for defining a crop from which to
sample brightness values. The script optionally runs in the
system-tray.</p>
<p>The examples may require customising for your own webcam and lighting
conditions.</p>
<h2 id="lux-metering-and-brightness-transitions">Lux Metering and
brightness transitions</h2>
<p>Due to VDU hardware and DDC protocol limitations, gradual transitions
from one brightness level to another are likely to be noticeable and
potentially annoying. The auto-brightness adjustment feature includes
several measures to reduce the amount of stepping when transitioning to
a final value:</p>
<ul>
<li>Lux/Brightness Profiles may define brightness-steps so that
brightness levels remain constant over set ranges of lux values.</li>
<li>Adjustments are only made at intervals of one or more minutes.</li>
<li>Large adjustments are made with larger step sizes to shorten the
transition period.</li>
<li>The adjustment task passes lux values through a smoothing low-pass
filter.</li>
</ul>
<p>When ambient light conditions are fluctuating, for example, due to
passing clouds, automatic adjust can be suspended. The main-panel,
main-menu, and light-metering dialog each contain controls for toggling
Auto/Manual. Additionally, moving the manual slider turns off automatic
adjustment.</p>
<p>The Light-metering dialog includes an option to enable
auto-brightness interpolation. This option will enable the calculation
of values between steps in the profiles. In order to avoid small
fluctuating changes, interpolation won’t result in brightness changes
less than 10%. During interpolation, if a lux value is found to be in
proximity to any attached preset, the preset values will be preferred
over interpolated ones.</p>
<h2 id="lightlux-metering-and-presets">Light/Lux Metering and
Presets</h2>
<p>The Light-Metering Dialog includes the ability to set a Preset to
trigger at a lux value. This feature is accessed by hovering under the
bottom axis of the Lux Profile Chart.</p>
<p>When a preset is tied to a lux value, the preset’s VDU brightness
values become fixed points on the Lux Profile Chart. When the specified
metered lux value is achieved, the stepping process will restore the
preset’s brightness values and then trigger the full restoration of the
preset. This ordering of events reduces the likelihood of
metered-stepping, and preset-restoration from clashing.</p>
<p>A preset that does not include a VDU’s brightness may be attached to
a lux point to restore one or more non-brightness controls. For example,
on reaching a particular lux level, an attached preset might restore a
contrast setting.</p>
<p>If a preset is attached to a lux value and then detached, the
preset’s profile points will be converted to normal (editable) profile
points. Attach/detach is a quick way to copy VDU brightness values from
presets if you don’t want to permanently attach them.</p>
<p>If you utilise light-metered auto-brightness and preset-scheduling
together, their combined effects may conflict. For example, a scheduled
preset may set a reduced brightness, but soon after, light-metering
might increase it. If you wish to use the two together, design your
lux/brightness profile steps to match the brightness levels of specific
presets, for example, a full-sun preset and the matching step in a
lux/brightness Profile might both be assigned the same brightness
level.</p>
<h2 id="lux-metering-internal-parameters">Lux Metering Internal
Parameters</h2>
<p>The following internal constants can be altered by manually editing
<code>~/.config/vdu_controls/AutoLux.conf</code>. They guide the various
metering and auto-adjustment heuristics::</p>
<pre><code>  [lux-meter]
  # How many times per minute to sample from the Lux meter (for auto-adjustment)
  samples-per-minute=3
  # How many samples to include in the smoothing process
  smoother-n=5
  # How heavily should past values smooth the present value (smaller = more smoothing)
  # See: https://en.wikipedia.org/wiki/Low-pass_filter#Simple_infinite_impulse_response_filter
  smoother-alpha=0.5
  # If an interpolated value yields a change in brightness, how big should the change
  # be to trigger an actual VDU change in brightness? Also determines how close
  # an interpolated value needs to be to an attached preset&#39;s brightness in order
  # to prefer triggering the preset over applying the interpolated value.
  interpolation-sensitivity-percent=10</code></pre>
<h2
id="improving-response-time-dynamic-optimization-and-sleep-multipliers">Improving
Response Time: Dynamic Optimization and Sleep Multipliers</h2>
<p>If you are using <code>ddcutil</code> version 2.0 or greater,
<code>vdu_controls</code> will default to using the <code>ddcutil</code>
<em>dynamic sleep optimiser</em>. The optimiser automatically tunes and
caches VDU specific timings when ever <code>ddcutil</code> is run. Any
reliability-issues or errors may be automatically resolved as the
optimiser refines it’s cached timings. Should problems persist, the
optimiser can be disabled by adding <code>--disable-dynamic-sleep</code>
to the <strong>ddcutil extra arguments</strong> in the <strong>Settings
Dialog</strong> (either globally on the <strong>vdu_controls
tab</strong> or selectively under each VDU’s tab). If dynamic sleep is
disabled, multipliers can then be manually assigned. The optimiser’s
heuristics continue to be refined, it may be that some issues may be
resolved by moving to a more recent version of
<code>libddcutil/ddcutil</code>.</p>
<p>For versions of <code>ddcutil</code> prior to 2.0, you can manually
set the <code>vdu_control</code> <code>sleep-multiplier</code> passed to
<code>ddcutil</code>. A sleep multiplier less than one will speed up the
i2c protocol interactions at the risk of increased protocol errors. The
default sleep multiplier of 1.0 has to be quite conservative, many VDUs
can cope with smaller multipliers. A bit of experimentation with
multiplier values may greatly speed up responsiveness. In a multi-VDU
setup individual sleep multipliers can be configured (see previous
section).</p>
<h2
id="improving-response-time-and-reliability-connections-and-controls">Improving
Response Time and Reliability: Connections and Controls</h2>
<p><code>DDC/I2C</code> is not a totally reliable form of communication.
VDUs may vary in their responsiveness and compliance. GPUs, GPU drivers,
and types of connection may affect the reliability. Both ddcutil and
vdu_controls attempt to manage the reliability by using repetition and
by adjusting timings.</p>
<p>If you have the choice, a <code>DisplayPort</code> to
<code>DisplayPort</code> connection may be more reliable than
<code>DVI</code> or <code>HDMI</code>.</p>
<p>Reducing the number of enabled controls can speed up initialisation,
decrease the refresh time, and reduce the time taken to restore
presets.</p>
<p>There’s plenty of useful info for getting the best out of
<code>ddcutil</code> at https://www.ddcutil.com/.</p>
<h1 id="limitations">Limitations</h1>
<p>There has been speculation that repeatably altering VDU settings
might affect VDU lifespan. Possible reasons include the consumption of
NVRAM write cycles, stressing the VDU power-supply, or increasing the
LED panel burn-in.</p>
<p>That said, <code>vdu_controls</code> does include a number of
features that can be used to reduce the overall frequency of
adjustments.</p>
<ul>
<li><p>Inbuilt mitigations:</p>
<ul>
<li>Slider and spin-box controls only update the VDU when adjustments
becomes small or stop.</li>
<li>Transitions during ambient-light-level brightness adjustment are
limited to changes of greater than 20%.</li>
<li>Automatic ambient brightness adjustment only triggers a change when
the proposed brightness differs from the current brightness by at least
10%.</li>
</ul></li>
<li><p>Electable mitigations:</p>
<ul>
<li>Choose to restore pre-prepared ‘presets’ instead of dragging
sliders.</li>
<li>Refrain from adding transitions to <code>presets</code>.</li>
<li>Turn off <code>interpolation</code> for ambient brightness response
curves, brightness will stair-step instead of ramping through
intermediate values.</li>
<li>Attach <code>presets</code> to ambient brightness response curves,
brightness will then tend to jump to the closest presets.</li>
<li>Engage the manual override when faced with rapidly fluctuating
levels of ambient brightness.</li>
<li>Consider adjusting the ambient lighting instead of the VDU.</li>
</ul></li>
</ul>
<h2 id="other-concerns">Other concerns</h2>
<p>The power-supplies in some older VDUs may buzz/squeel audibly when
the brightness is turned way down. This may not be a major issue
because, in normal surroundings, older VDUs are often not usable below
about 85-90% brightness.</p>
<p>Going beyond the standard DDC features by attempting to experiment
with hidden or undocumented features or values has the potential to make
irreversible changes.</p>
<p>Some controls change the number of connected devices (for example,
some VDUs support a power-off command). If such controls are used,
<code>vdu_controls</code> will detect the change and will reconfigure
the controls for the new situation (for example, DDC VDU 2 may now be
DDC VDU 1). If you change settings independently of
<code>vdu_controls</code>, for example, by using a VDU’s physical
controls, the <code>vdu_controls</code> UI includes a refresh button to
force it to assess the new configuration.</p>
<p>Some VDU settings may disable or enable other settings in the VDU.
For example, setting a VDU to a specific picture-profile might result in
the contrast-control being disabled, but <code>vdu_controls</code> will
not be aware of the restriction resulting in its contrast-control erring
or appearing to do nothing.</p>
<p>If your VDUs support <em>picture-modes</em>, altering any controls in
vdu_controls will most likely result in the picture-mode being
customised. For example, say you have selected the VDU’s <em>Vivid</em>
picture-mode, if you use vdu_controls to change the brightness, it’s
likely that this will now become the brightness for <em>Vivid</em> until
the VDU is reset to its defaults. To avoid confusion, it may be
advisable to stick to one picture-mode for use with vdu_controls,
preserving the others unaltered.</p>
<p>The <code>ddcutil-service</code> has some ability to signal hot-plug
events, such as connecting a new VDU or powering one down. Not all
GPU-drivers support an efficient means of event detection, as a result
there may be a delay of many seconds before <code>ddcutil-service</code>
passes these events to <code>vdu_controls</code>.</p>
<p>Builtin laptop displays normally don’t implement DDC and those
displays are not supported, but a laptop’s externally connected VDUs are
likely to be controllable.</p>
<h1 id="examples">Examples</h1>
<pre><code>vdu_controls
    All default controls.

vdu_controls --show brightness --show contrast
    Specified controls only:

vdu_controls --hide contrast --hide audio-volume
    All default controls except for those to be hidden.

vdu_controls --system-tray --no-splash --show brightness --show audio-volume
    Start as a system tray entry without showing the splash-screen.

vdu_controls --create-config-files --system-tray --no-splash --show brightness --show audio-volume
    Create template config files in $HOME/.config/vdu_controls/ that include the other settings.

vdu_controls --enable-vcp-code 63 --enable-vcp-code 93 --warnings --debug
    All default controls, plus controls for VCP_CODE 63 and 93, show any warnings, output debugging info.</code></pre>
<p>This script often refers to displays and monitors as VDUs in order to
disambiguate the noun/verb duality of “display” and “monitor”</p>
<h1 id="prerequisites">Prerequisites</h1>
<p>Described for OpenSUSE, similar for other distros:</p>
<p>Software::</p>
<pre><code>    zypper install python3 python3-qt5 noto-sans-math-fonts noto-sans-symbols2-fonts
    zypper install ddcutil
    zypper install libddcutil ddcutil-service  # optional, but recommended if availabled</code></pre>
<p>If you wish to use a serial-port lux metering device, the
<code>pyserial</code> module is a runtime requirement.</p>
<p>Get ddcutil working first. Check that the detect command detects your
VDUs without issuing any errors:</p>
<pre><code>    ddcutil detect</code></pre>
<p>Read ddcutil documentation concerning config of i2c_dev with nvidia
GPUs. Detailed ddcutil info at https://www.ddcutil.com/</p>
<h1 id="environment">Environment</h1>
<pre><code>LC_ALL, LANG, LANGUAGE
    These  variables specify the locale for language translations and units of distance.
    LC_ALL is used by python, LANGUAGE is used by Qt. Normally, they should all have the same
    value, for example: ``Da_DK``. For these to have any effect on language, ``Settings``
    ``Translations Enabled`` must also be enabled.

VDU_CONTROLS_UI_IDLE_SECS
    The length of pause in slider or spin-box control motion that triggers commit of
    the controls value to the VDU.  This is a precautionary throttle in case frequently
    updating a VDU might shorten its lifespan.  The default is 0.5 seconds.

VDU_CONTROLS_IPINFO_URL
    This variable overrides the default ip-address to location service URL (``https://ipinfo.io/json``).

VDU_CONTROLS_WTTR_URL
    This variable overrides default weather service URL (``https://wttr.in``).

VDU_CONTROLS_WEATHER_KM
    This variable overrides the default maximum permissible spherical distance (in kilometres)
    between the ``Settings`` ``Location`` and ``wttr.in`` reported location (``200 km``, 124 miles).

VDU_CONTROLS_DDCUTIL_ARGS
    This variable adds to the list of arguments passed to each exec of ddcutil.

VDU_CONTROLS_DEVELOPER
    This variable changes some search paths to be more convenient in a development
    scenario. (``no`` or yes)</code></pre>
<h1 id="files">Files</h1>
<pre><code>$HOME/.config/vdu_controls/
    Location for config files, Presets, and other persistent data.

$HOME/.config/vdu_controls/tray_icon.svg
    If present, this file is the preferred source for the system-tray icon. It can be used if the normal
    icon conflicts with the desktop theme. If the ``Settings`` ``monochrome-tray``
    and ``mono-light-tray`` are enabled, they are applied to the file when it is read.

$HOME/.config/vdu_controls/translations/
    Location for user supplied translations.

$HOME/.config/vdu_controls.qt.state/
    Location for Qt/desktop state such as the past window sizes and locations.

/usr/share/vdu_controls
    Location for system-wide icons,  sample-scripts, and  translations.</code></pre>
<h1 id="reporting-bugs">Reporting Bugs</h1>
<p>https://github.com/digitaltrails/vdu_controls/issues</p>
<h1 id="gnu-license">GNU License</h1>
<p>This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by the
Free Software Foundation, version 3.</p>
<p>This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with this program. If not, see https://www.gnu.org/licenses/.</p>
